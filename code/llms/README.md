# 兩階段 TTAS 檢傷分類系統 (Two-Stage TTAS Triage System)

本目錄包含結合生理數據 (Random Forest) 與大型語言模型 (Qwen-3-4B) 的兩階段檢傷分類系統實作。

## 檔案說明

*   **`main.py`**: 程式的主要執行入口。負責初始化模型、模擬病患數據，並執行完整的檢傷流程。
*   **`model_init.py`**: 負責載入與初始化 `Qwen/Qwen3-4B-Instruct-2507` 模型。支援自動偵測 GPU 加速。
*   **`predict.py`**: 包含核心預測邏輯：
    *   **第一階段 (Stage 1)**: 載入預訓練的 Random Forest 模型 (`model.pkl`) 與編碼器 (`encoder.pkl`)，根據生理數據進行初步分類。
        *   **特徵工程**: 系統會自動處理 24 項生理特徵，包含：
            *   **生命徵象**: 體溫、體重、收縮壓、舒張壓、脈搏、呼吸、SAO2、身高。
            *   **昏迷指數 (GCS)**: GCS_E, GCS_V, GCS_M 及其總分 (GCS_Total)。
            *   **衍生指標**: 休克指數 (Shock Index = 脈搏/收縮壓)、年齡 (Age)、主訴長度 (Complaint_Length)。
            *   **類別特徵**: 性別、瞳孔反應、LMP，並使用 `encoder.pkl` 進行編碼。
            *   **缺失值標記**: 針對重要生命徵象建立缺失標記欄位。
        *   **預測輸出**: 輸出初步檢傷級數 (1-5 級)，作為第二階段 LLM 的參考輸入。
    *   **第二階段 (Stage 2)**: 結合第一階段的結果(1-5 級)與病患主訴，利用 LLM 進行綜合判斷並給出最終檢傷級數。

## 執行方式

請確保已安裝相關套件，並在專案根目錄下執行：

```bash
uv run code/llms/main.py
```

> **注意**: 首次執行時會下載約 8GB 的 Qwen 模型權重，請耐心等待。
